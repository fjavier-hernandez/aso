
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://fjavier-hernandez.github.io/aso/04_LDAP/043_LDAP_Esquema.html">
      
      <link rel="icon" href="../imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.6">
    
    
      
        <title>043 LDAP Esquema - Administración de Sistemas Operativos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.802231af.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      

  


  

  


  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0CPJP88MBF"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-0CPJP88MBF",{page_path:t.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0CPJP88MBF"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="javi" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#esquema-ldap" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../index.html" title="Administración de Sistemas Operativos" class="md-header__button md-logo" aria-label="Administración de Sistemas Operativos" data-md-component="logo">
      
  <img src="../imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Administración de Sistemas Operativos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              043 LDAP Esquema
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="javi" data-md-color-primary="" data-md-color-accent=""  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Administración de Sistemas Operativos" class="md-nav__button md-logo" aria-label="Administración de Sistemas Operativos" data-md-component="logo">
      
  <img src="../imagenes/logofp.png" alt="logo">

    </a>
    Administración de Sistemas Operativos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Inicio
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        1.- UD1. ShellScripting
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="1.- UD1. ShellScripting" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          1.- UD1. ShellScripting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01_ShellScripting/ProgramacionAula.html" class="md-nav__link">
        Programación de Aula
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01_ShellScripting/ResumenUD.html" class="md-nav__link">
        Resumen UD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01_ShellScripting/011_ShellScript_Intro.html" class="md-nav__link">
        1.1- Introducción
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01_ShellScripting/012_ShelScript_Sintaxis.html" class="md-nav__link">
        1.2- Sintaxis
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01_ShellScripting/013_ShellScript_ControlFlujo.html" class="md-nav__link">
        1.3- Control de flujo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01_ShellScripting/014_ShellScript_VectoresFunciones.html" class="md-nav__link">
        1.4- Vectores y Funciones
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01_ShellScripting/015_ShellScript_RefuerzoAmpliacion.html" class="md-nav__link">
        1.5- Refuerzo y ampliación
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01_ShellScripting/016_ShellScript_PruebaEspecifica.html" class="md-nav__link">
        1.6- Prueba Auditoria
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        2.- UD2: PowerShell
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="2.- UD2: PowerShell" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          2.- UD2: PowerShell
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../02_PowerShell/ProgramacionAula.html" class="md-nav__link">
        Programación de Aula
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../02_PowerShell/021_Introduccio%CC%81nPwSh.html" class="md-nav__link">
        2.1- Introducción
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../02_PowerShell/022_PowerShell_Sintaxis.html" class="md-nav__link">
        2.2- Sintaxis
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../02_PowerShell/023_PowerShell_ControlFlujo.html" class="md-nav__link">
        2.3- Control de flujo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../02_PowerShell/024_PowerShell_VectoresFunciones.html" class="md-nav__link">
        2.4- Vectores y Funciones
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        3.- UD3: Administración de procesos del sistema
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="3.- UD3: Administración de procesos del sistema" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          3.- UD3: Administración de procesos del sistema
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03_Procesos/ProgramacionAula.html" class="md-nav__link">
        Programación de Aula
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03_Procesos/031_Planificador.html" class="md-nav__link">
        3.1- Introducción Procesos, Planificador
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03_Procesos/032_Hilos.html" class="md-nav__link">
        3.2- Hilos, Sincronización e interrupciones, Herramientas gráficas
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03_Procesos/033_GestionProcesosShell.html" class="md-nav__link">
        3.3- Gestión de procesos en Shell de Linux.
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03_Procesos/034_GestionProcesosPWSH.html" class="md-nav__link">
        3.4- Gestión de procesos en PowerShell.
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03_Procesos/035_ArranqueServicios.html" class="md-nav__link">
        3.5- Arranque del sistema. Servicios. Systemd.
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        4.- Servicios de Directorio Libres: LDAP
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="4.- Servicios de Directorio Libres: LDAP" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          4.- Servicios de Directorio Libres: LDAP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="ProgramacionAula.html" class="md-nav__link">
        Programación de Aula
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="041_Introduccion_SDyLDAP.html" class="md-nav__link">
        4.1- Introducción Servicios de directorio y LDAP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="Practica01_LDAP.html" class="md-nav__link">
        4.2- Instalación y configuración de OpenLDAP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="042_LDAP_DIT.html" class="md-nav__link">
        4.3- Modelo de Información de LDAP
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>043 LDAP Esquema</h1>
                
                <h2 id="esquema-ldap">Esquema LDAP<a class="headerlink" href="#esquema-ldap" title="Permanent link">&para;</a></h2>
<p>El <strong>esquema</strong> es una parte importante de LDAP. Similar a la definición del esquema de la base de datos, el esquema LDAP define la estructura y las reglas que debe seguir un directorio LDAP, como qué atributos tendrá una clase de objeto, qué estructura tienen estos atributos, etc. </p>
<ul>
<li>El <strong>servidor LDAP</strong> proporciona una manera de <strong>identificar categorías, atributos</strong> y otra información en el directorio LDAP, para que el servidor LDAP pueda reconocerlos. <strong>Para realizarlo se utlizan esquemas</strong>, que no es más que una <strong>unidad de empaquetado conveniente para contener clases de objetos y atributos muy similares</strong>.</li>
<li><strong>La principal diferencia</strong> con las bases de datos relacionales del protocolo LDAP es que estas ya están predefinidas en los esquemas. por lo que nos ahorramos en insertar y definir las tablas de información.</li>
<li>En <strong>OpenLDAP</strong> los esquemas instalados se encuentran en cn = schema, cn = config y se pueden instalar esquemas adicionales usando este procedimiento.</li>
</ul>
<p>El siguiente diagrama ilustra el uso de esquemas como unidades de empaquetado:</p>
<figure>
  <img src="imagenes/02/EsquemaLdap.png" width="700"/>
  <figcaption>Ejemplo de la definición de Esquemas en LDAP</figcaption>
</figure>

<p>A nivel de comandos se pueden ver los esquemas predefinidos con:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">cd /etc/ldap/slapd.d/cn\=config/</span>
</code></pre></div>
<p>En el directorio <code>cn\=schema</code> se pueden ver los esquemas y ademas se pueden añadir más, pero no suele ser frecuente.</p>
<p>Para buscar los esquemas se puede utilizar:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">grep olcObjectClasses cn\=\{3\}inetorgperson.ldif|awk &#39;{print $5}&#39;</span>
<span class="linenos" data-linenos="2 "></span><span class="l l-Scalar l-Scalar-Plain">grep olcObjectClasses cn\=\{2\}inetorgperson.ldif|awk &#39;{print $5}&#39;</span>
<span class="linenos" data-linenos="3 "></span><span class="l l-Scalar l-Scalar-Plain">grep olcObjectClasses cn\=\{2\}nis.ldif|awk &#39;{print $5}&#39;</span>
<span class="linenos" data-linenos="4 "></span><span class="l l-Scalar l-Scalar-Plain">grep olcObjectClasses cn\=\{1\}cosine.ldif|awk &#39;{print $5}&#39;</span>
<span class="linenos" data-linenos="5 "></span><span class="l l-Scalar l-Scalar-Plain">grep olcObjectClasses cn\=\{0\}core.ldif|awk &#39;{print $5}&#39;</span>
</code></pre></div></p>
<h2 id="herramientas-de-gestion-de-usuarios">Herramientas de gestión de usuarios.<a class="headerlink" href="#herramientas-de-gestion-de-usuarios" title="Permanent link">&para;</a></h2>
<p>Una vez configurado el servidor LDAP, para la utilización normal debemos aprender cómo se añaden nuevos usuarios o se modifican los atributos de los existentes.</p>
<ul>
<li>
<p>Para los objetos iniciales del directorio, primero se debe escribir un fichero en formato <strong>LDIF</strong> que incluya todos los atributos de la entrada y añadirla al directorio con slapadd. En la <a href="#Actividades Desarrollo UD2_01">Actividades Desarrollo UD2_01</a>, se realizará un ejemplo guiado al respecto.</p>
</li>
<li>
<p>Este método es totalmente inadecuado para la utilización cuando el directorio está activo. Existen varias formas de actualizar las entradas del directorio o añadir nuevas, y en primer lugar veremos la utilización de las herramientas incluidas en el paquete <strong>ldap-utils</strong>.</p>
</li>
</ul>
<h3 id="ldap-utils">ldap-utils<a class="headerlink" href="#ldap-utils" title="Permanent link">&para;</a></h3>
<p>Para realizar modificaciones de los objetos del directorio directamente desde la línea de comandos, se pueden utilizar las herramientas del paquete <code>ldap-utils</code>, a continuación se describen algunas de ellas.</p>
<h4 id="mostrar-entradas">Mostrar entradas<a class="headerlink" href="#mostrar-entradas" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ldapsearch</code> - buscar y mostrar entradas</li>
</ul>
<p>La herramienta <code>ldapsearch</code> resulta muy conveniente al momento de hacer consultas sobre los datos dentro de un directorio LDAP desde línea de comandos. </p>
<ul>
<li>A continuación se presentan una serie de consultas de ejemplo que pueden resultar muy útiles para obtener información valiosa de un árbol LDAP.</li>
</ul>
<h4 id="obtener-todos-los-objetos-de-un-directorio">Obtener todos los objetos de un directorio<a class="headerlink" href="#obtener-todos-los-objetos-de-un-directorio" title="Permanent link">&para;</a></h4>
<p>Para obtener todos los objetos en un directorio (dn) a partir de cierta base con el ejemplo de la práctica (<code>dc=pandora,dc=ldap</code>) y sin límite de para la respuesta, utilizar una consulta como la siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapsearch -z 0 -H ldap://localhost:389 -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; -b &quot;dc=pandora,dc=ldap&quot; &quot;(objectclass=*)&quot;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><code>-z 0</code>: evita cortar la respuesta una vez alcanzado cierto límite (cantidad de entradas).</li>
<li><code>-H ldap://localhost:389</code>: indica que consulte al servidor LDAP en el puerto 389 del host local.</li>
<li><code>-W</code>: indica que solicite la contraseña para el método de autenticación simple de manera interactiva.</li>
<li><code>-D "cn=admin,dc=pandora,dc=ldap"</code>: especifica el usuario con el cual se autentica en el servidor LDAP.</li>
<li><code>-b "dc=pandora,dc=ldap"</code>: especifica la base desde donde comenzar la búsqueda (en este caso se trata de la raíz del directorio).</li>
<li><code>"(objectclass=*)"</code>: especifica el filtro para la búsqueda (en este ejemplo todos los objetos, este a su vez es el filtro por defecto).</li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>El punto importante es no olvidar especificar la base (<code>-b</code>). De lo contrario probablemente no haya resultados en la búsqueda:</p>
</div>
<ul>
<li>A este ejemplo se le puede añadir <code>grep</code> para filtrar sólo los dn:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapsearch -z 0 -H ldap://localhost:389 -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; -b &quot;dc=pandora,dc=ldap&quot; &quot;(objectclass=*)&quot; | grep &quot;dn:&quot;</span>
</code></pre></div>
<ul>
<li>El resultado sería parecido a:</li>
</ul>
<p><img alt="" src="imagenes/02/BusqObjtLDAP.png" /></p>
<h4 id="obtener-todas-las-unidades-organizacionales">Obtener todas las unidades organizacionales<a class="headerlink" href="#obtener-todas-las-unidades-organizacionales" title="Permanent link">&para;</a></h4>
<p>Las <a href="https://technet.microsoft.com/en-us/library/cc978003.aspx">ou</a> (<em>Organizational Unit</em>) definen la jerarquía dentro de un dominio. Generalmente se utilizan para definir los departamentos o áreas dentro de una organización (empresa, red, sociedad, etc.).</p>
<p>Para obtener una lista de todas las ou presentes en un directorio, se puede utilizar el filtro <code>"(ou=*)"</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapsearch -z 0 -H ldap://localhost:389 -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; -b &quot;dc=pandora,dc=ldap&quot; &quot;(ou=*)&quot; | grep &quot;dn:&quot;</span>
</code></pre></div>
<ul>
<li>Resultado</li>
</ul>
<p><img alt="" src="imagenes/02/BusqOuLDAP.png" /></p>
<h4 id="listar-todos-los-usuarios">Listar todos los usuarios<a class="headerlink" href="#listar-todos-los-usuarios" title="Permanent link">&para;</a></h4>
<p>Esta consulta depende de la jerarquía y la clase utilizada para almacenar usuarios dentro de un árbol LDAP. Sin embargo, generalmente se utiliza la clase <a href="https://tools.ietf.org/html/rfc2798">inetOrgPerson</a> para almacenar usuarios dentro de un directorio LDAP, la cual posee el atributo <code>uid</code>.</p>
<p>De esta forma, para listar todos los usuarios presentes en un directorio, simplemente recurrir al filtro <code>"(uid=*)"</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapsearch -z 0 -H ldap://localhost:389 -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; -b &quot;dc=pandora,dc=ldap&quot; &quot;(uid=*)&quot; | grep &quot;dn:&quot;</span>
</code></pre></div>
<ul>
<li>Resultado</li>
</ul>
<p><img alt="" src="imagenes/02/BusqUsuerLDAP.png" /></p>
<h4 id="determinar-todas-las-clases-en-uso">Determinar todas las clases en uso<a class="headerlink" href="#determinar-todas-las-clases-en-uso" title="Permanent link">&para;</a></h4>
<p>Las clases de un directorio LDAP determinan el formato con el que se representan los datos de los objetos almacenados en el árbol. Cada objeto (entrada en un directorio LDAP) pertenece a al menos una clase. Sin embargo es común que cada objeto pertenezca a varias clases. Básicamente las clases definen qué atributos y de qué formato puede poseer un objeto.</p>
<p>Para listar todas las clases actualmente en uso por todos los objetos, es necesario volcar todo el contenido del árbol y filtrar con <code>grep</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapsearch -z 0 -H ldap://localhost:389 -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; -b &quot;dc=pandora,dc=ldap&quot; &quot;(objectclass=*)&quot; | grep objectClass | sort | uniq</span>
</code></pre></div>
<ul>
<li>Resultado</li>
</ul>
<p><img alt="" src="imagenes/02/BusqClassLDAP.png" /></p>
<h4 id="manipular-entradas">Manipular entradas<a class="headerlink" href="#manipular-entradas" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><code>ldapmodify</code> - modificar una entrada</p>
</li>
<li>
<p><code>ldapadd</code> - agregar una nueva entrada</p>
</li>
<li>
<p><code>ldapdelete</code> - eliminar y entrar</p>
</li>
<li>
<p><code>ldapmodrdn</code> - cambiar el nombre de una entrada</p>
</li>
<li>
<p><code>ldappasswd</code> : cambie la contraseña de una entrada</p>
</li>
</ul>
<h6 id="ejemplos">Ejemplos:<a class="headerlink" href="#ejemplos" title="Permanent link">&para;</a></h6>
<ol>
<li>
<p>Añadir y eliminar nuevos grupos con <code>ldapadd</code> &amp; <code>ldapdelete</code></p>
<ol>
<li>Se crea un archivo .ldif para añadir un nuevo grupo y se añade con <code>ldapadd</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">nano aso.ldif</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">dn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ou=aso,dc=pandora,dc=ldap</span>
<span class="linenos" data-linenos="2 "></span><span class="nt">objectClass</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">organizationalUnit</span>
<span class="linenos" data-linenos="3 "></span><span class="nt">objectClass</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">top</span>
<span class="linenos" data-linenos="4 "></span><span class="nt">ou</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aso</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapadd -x -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; -f aso.ldif</span>
</code></pre></div>
<ol start="2">
<li>Para borrarlo se utilizaría: </li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapdelete -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; &quot;ou=aso,dc=pandora,dc=ldap&quot;</span>
</code></pre></div>
</li>
<li>
<p>Añadir y eliminar usuarios con <code>ldapadd</code> &amp; <code>ldapdelete</code></p>
<ol>
<li>Se crea un archivo .ldif para añadir un nuevo grupo y se añade con <code>ldapadd</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">nano javier.ldif</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nt">dn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">uid=javier,ou=usuarios,dc=pandora,dc=ldap</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nt">objectClass</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">inetOrgPerson</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nt">objectClass</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">posixAccount</span>
<span class="linenos" data-linenos=" 4 "></span><span class="nt">objectClass</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">shadowAccount</span>
<span class="linenos" data-linenos=" 5 "></span><span class="nt">cn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Javier</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nt">sn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Hernandez</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nt">userPassword</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nv">SSHA</span><span class="p p-Indicator">}</span><span class="l l-Scalar l-Scalar-Plain">latDDmodpsLUWDqwd/adk/j2tTDgz3NX</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nt">loginshell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nt">uidNumber</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10001</span>
<span class="linenos" data-linenos="10 "></span><span class="nt">gidNumber</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10001</span>
<span class="linenos" data-linenos="11 "></span><span class="nt">homeDirectory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/javier</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapadd -x -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; -f javier.ldif</span>
</code></pre></div>
<ol start="2">
<li>Para borrarlo se utilizaría: </li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapdelete -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; &quot;uid=javier,ou=aso,dc=pandora,dc=ldap&quot;</span>
</code></pre></div>
</li>
<li>
<p>modificar <code>uidnumber</code> de usuario existente <code>ldapmodify</code></p>
<ol>
<li>Se crea un archivo .ldif especificando las modificaciones:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">nano cambios1.ldif</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">dn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">uid=javier,ou=aso,dc=pandora,dc=ldap</span>
<span class="linenos" data-linenos="2 "></span><span class="l l-Scalar l-Scalar-Plain">changetype:modify</span>
<span class="linenos" data-linenos="3 "></span><span class="l l-Scalar l-Scalar-Plain">replace:uidNumber</span>
<span class="linenos" data-linenos="4 "></span><span class="l l-Scalar l-Scalar-Plain">uidNumber:10002</span>
</code></pre></div>
<ol start="2">
<li>Para modificarlo se utilizaría: </li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldapmodify -x -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; -f cambios1.ldif</span>
</code></pre></div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>Cuatro tipos de cambios son posibles<ol>
<li>add--adds a new entry</li>
<li>modify--changes an existing entry, that is, it adds, deletes, or replaces attributes of the entry</li>
<li>delete--deletes an existing entry</li>
<li>modrdn--modifies the RDN of an existing entry</li>
</ol>
</li>
</ul>
</div>
<ol start="4">
<li>
<p>Añadir y cambiar contraseña a un usuario existente con <code>ldappasswd</code></p>
<ol>
<li>Añadir contraseña</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">ldappasswd -s 1234 -W -D &quot;cn=admin,dc=pandora,dc=ldap&quot; -x &quot;uid=javier,ou=aso,dc=pandora,dc=ldap&quot;</span>
</code></pre></div>
</li>
</ol>
<h4 id="operaciones">Operaciones<a class="headerlink" href="#operaciones" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><code>ldapwhoami</code> : muestra con qué entrada estoy vinculado al servidor</p>
</li>
<li>
<p><code>ldapcompare</code> : compara un campo en la entrada con algún valor</p>
</li>
</ul>
<h2 id="configuracion-de-openldap">Configuración de OpenLDAP<a class="headerlink" href="#configuracion-de-openldap" title="Permanent link">&para;</a></h2>
<h3 id="slapdconf"><code>slapd.conf</code><a class="headerlink" href="#slapdconf" title="Permanent link">&para;</a></h3>
<p>Es el archivo principal de OpenLDAP y es aquí donde se configuran todos sus parámetros.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><code>slapd.conf</code>se encuentra dentro del directorio <code>/etc/ldap/slapd.d</code></li>
</ul>
</div>
<h4 id="diseno-de-configuracion">Diseño de configuración<a class="headerlink" href="#diseno-de-configuracion" title="Permanent link">&para;</a></h4>
<p>La configuración de slapd se almacena <strong>como un directorio LDAP especial con un esquema y DIT predefinidos</strong>. </p>
<ul>
<li>Hay clases de objetos específicas que se utilizan para llevar opciones de configuración global, definiciones de esquema, definiciones de base de datos y back-end, y otros elementos variados.</li>
</ul>
<figure>
  <img src="imagenes/02/ConfigTreeLDAP.png" width="600"/>
  <figcaption>Árbol de configuración de muestra.</figcaption>
</figure>

<ul>
<li>En el servidor se podría observar:</li>
</ul>
<figure>
  <img src="imagenes/02/TreeLDAPconf.png" width="400"/>
  <figcaption>Árbol (DIT)de configuración En Ubuntu Server.</figcaption>
</figure>

<p>El árbol de configuración de slapd-config tiene una estructura muy específica. La raíz del árbol se denomina cn = config y contiene ajustes de configuración global.</p>
<h4 id="directivas-de-configuracion">Directivas de configuración<a class="headerlink" href="#directivas-de-configuracion" title="Permanent link">&para;</a></h4>
<p>De las directivas más comunes mostradas en el arblo se destaca centro de <code>cn = config</code> la directiva <code>olcLogLevel</code></p>
<ul>
<li>Esta directiva especifica el nivel en el que las declaraciones de depuración y las estadísticas de operación deben registrarse en el syslog (actualmente registrado en la función <strong>syslogd (8) LOG_LOCAL4 )</strong>. </li>
<li>Debe haber configurado OpenLDAP --enable-debug (el predeterminado) para que esto funcione (excepto para los dos niveles de estadísticas, que siempre están habilitados).</li>
</ul>
<h5 id="configuracion-logging">Configuración logging<a class="headerlink" href="#configuracion-logging" title="Permanent link">&para;</a></h5>
<p>El registro de actividad para slapd es muy útil cuando se implementa una solución basada en OpenLDAP, pero debe habilitarse manualmente después de la instalación del software. De lo contrario, solo aparecerán mensajes rudimentarios en los registros. El registro, como cualquier otra configuración similar, se habilita a través de la base de datos <strong>slapd-config</strong> .</p>
<ul>
<li>OpenLDAP viene con múltiples niveles de registro y cada uno contiene el más bajo (aditivo). </li>
<li>Un buen nivel para probar son las <em>estadísticas</em> . La página de manual de <a href="https://manpages.ubuntu.com/manpages/focal/en/man5/slapd-config.5.html?_ga=2.248400327.1524111619.1636497214-637147953.1635270894">slapd-config</a> tiene más que decir sobre los diferentes subsistemas.</li>
</ul>
<ol>
<li>Cree el archivo <code>logging.ldif</code> con el siguiente contenido:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">dn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cn=config</span>
<span class="linenos" data-linenos="2 "></span><span class="nt">changetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">modify</span>
<span class="linenos" data-linenos="3 "></span><span class="nt">replace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">olcLogLevel</span>
<span class="linenos" data-linenos="4 "></span><span class="nt">olcLogLevel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stats</span>
</code></pre></div>
<ol start="2">
<li>Implementar el cambio:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">sudo ldapmodify -Q -Y EXTERNAL -H ldapi:/// -f logging.ldif</span>
</code></pre></div>
<p>Esto producirá una cantidad significativa de registro y querrá volver a un nivel menos detallado una vez que su sistema esté en producción. Mientras está en este modo detallado, el motor syslog de su host (rsyslog) puede tener dificultades para mantenerse al día y puede dejar caer mensajes:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>rsyslogd-2177: imuxsock lost 228 messages from pid 2547 due to rate-limiting</strong></p>
</div>
<p>Puede considerarse un cambio en la configuración de <code>rsyslog</code>. En <code>/etc/rsyslog.conf</code>, ponga:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Disable rate limiting</span>
<span class="linenos" data-linenos="2 "></span><span class="c1"># (default is 200 messages in 5 seconds; below we make the 5 become 0)</span>
<span class="linenos" data-linenos="3 "></span><span class="l l-Scalar l-Scalar-Plain">$SystemLogRateLimitInterval 0</span>
</code></pre></div>
<ol start="3">
<li>Y luego reinicie el demonio rsyslog:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">sudo systemctl restart syslog.service</span>
</code></pre></div>
<ol start="4">
<li>Los Registros de OpenLDAP a través de syslogd <strong>LOCAL4</strong> (Nivel warning de Syslog). Para transmitir el registro LDAP a un archivo separado de syslog, agregue una línea como esta a <strong>syslog.conf</strong> ( <code>/etc/rsyslog.conf</code>):</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1"># a. agregar a syslog.conf</span>
<span class="linenos" data-linenos=" 2 "></span><span class="l l-Scalar l-Scalar-Plain">local4. * /var/log/ldap.log</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="l l-Scalar l-Scalar-Plain"># b. crear un archivo de registro vacío</span>
<span class="linenos" data-linenos=" 5 "></span><span class="l l-Scalar l-Scalar-Plain">toque /var/log/ldap.log</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="l l-Scalar l-Scalar-Plain"># c. reiniciar syslogd</span>
<span class="linenos" data-linenos=" 8 "></span><span class="l l-Scalar l-Scalar-Plain">killall -HUP syslogd</span>
<span class="linenos" data-linenos=" 9 "></span><span class="l l-Scalar l-Scalar-Plain">O</span>
<span class="linenos" data-linenos="10 "></span><span class="l l-Scalar l-Scalar-Plain">systemctl restart syslog.service</span>
</code></pre></div>
<p><a href="http://www.zytrax.com/books/ldap/ch6/#logfile">Más información sobre looging OpenLdap</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2021-2022 Fº Javier Hernández - Licencia CC BY-NC-SA
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="mailto:<fj.hernandez@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM178.117 262.104C87.429 196.287 88.353 196.121 64 177.167V152c0-13.255 10.745-24 24-24h272c13.255 0 24 10.745 24 24v25.167c-24.371 18.969-23.434 19.124-114.117 84.938-10.5 7.655-31.392 26.12-45.883 25.894-14.503.218-35.367-18.227-45.883-25.895zM384 217.775V360c0 13.255-10.745 24-24 24H88c-13.255 0-24-10.745-24-24V217.775c13.958 10.794 33.329 25.236 95.303 70.214 14.162 10.341 37.975 32.145 64.694 32.01 26.887.134 51.037-22.041 64.72-32.025 61.958-44.965 81.325-59.406 95.283-70.199z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "toc.integrate", "navigation.indexes"], "translations": {"clipboard.copy": "Copiar al portapapeles", "clipboard.copied": "Copiado al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}, "search": "../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.756773cc.min.js"></script>
      
    
  </body>
</html>